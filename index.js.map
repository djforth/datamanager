{"version":3,"sources":["lib/dataManager.es6.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["const Immutable = require(\"immutable\");\nconst _         = require(\"lodash\");\n\nconst AjaxPromises  = require(\"ajax-es6-module\");\nconst DateFormatter = require(\"date-formatter\");\n\nclass DataManager {\n  add(m){\n    //Adding comment\n    this.addToHistory();\n\n    m = (_.isArray(m)) ? m : [m];\n    m = this.manageDates(m);\n    let current, newData;\n    if(this.data){\n      current = this.data.toJS();\n      newData = _.union(current, m);\n    } else {\n      newData = m;\n    }\n\n    this.data = Immutable.fromJS(newData).map((d)=> this.addDefaults(d));\n  }\n\n\n  addDates(item, keys){\n    _.forIn(item, function(v, k) {\n      if(_.contains(keys, k)){\n        let dateFmt = new DateFormatter(v);\n        item[k]   = dateFmt.getDate();\n        let key   = `${k}Df`;\n        item[key] = dateFmt;\n      }\n    });\n\n    return item;\n  }\n\n  addDefaults(d){\n    if(this.defaults){\n      _.forIn(this.defaults, (v, k)=> d = d.set(k, v));\n    }\n    return d;\n  }\n\n  addId(){\n    this.addToHistory();\n    this.data = this.data.map((d)=>{\n      if(!d.has(\"id\")){\n        d = d.set(\"id\", _.uniqueId());\n      }\n\n      return d;\n    });\n  }\n\n  addToHistory(){\n    if(this.data) {\n      this.history.push(this.data); //sets up history\n    }\n  }\n\n  dateSearch(key, st, fn) {\n    // let sort = this.sort(key);\n    if(!(_.isDate(st) && _.isDate(fn))){\n      // console.log('No dates');\n      throw new Error(\"Start and finish must be dates\");\n    }\n\n    return this.data.filter((d)=>{\n      var item = d.get(key);\n      return item > st && item < fn;\n    });\n\n  }\n\n\n  clearAll(){\n    this.addToHistory();\n    this.data = null;\n  }\n\n\n\n  constructor(defaults, ...args){\n\n    this.ajaxPromises = new AjaxPromises();\n    this.data         = null;\n\n    this.history  = [];\n    this.keys     = null;\n    // this.last     = null;\n    this.cid      = _.uniqueId(\"c\");\n\n    // let args = Array.prototype.slice.call(arguments);\n\n    this.defaults     = defaults;\n\n\n    if(_.isArray(args[0])){\n      this.add(args.shift());\n    }\n\n    let f   = _.last(args); // If fetch boolean set\n    let fet = (_.isBoolean(f)) ? args.pop() : false;\n\n    if(args.length > 0){\n      this.init(args[0], fet);\n    } else {\n      this.init(fet);\n    }\n\n  }\n\n  create(data){\n    if(this.dataCheck(data)){\n      this.add(data);\n\n      this.setUrl();\n\n      return this.ajaxPromises.create(data).catch((err)=>{\n        throw new Error(err);\n      });\n\n    }\n\n    return null;\n  }\n\n  dataCheck(d){\n    if(!this.data || !d){\n      this.warn((!this.data) ? \"No Data to update\" : \"Updates are not defined \");\n      // if(console.warn){\n      //   let warning = (!this.data) ? \"No Data to update\" : \"Updates are not defined \";\n      //   console.warn(warning);\n      // }\n\n      return false;\n    }\n\n    return true;\n  }\n\n  destroy(id){\n    if(this.dataCheck(id)){\n\n      this.setUrl();\n\n      let del = this.remove(id);\n      if(del){\n        return this.ajaxPromises.destroy(del.toJS()).catch((err)=>{\n          throw new Error(err);\n        });\n      }\n    }\n\n    return null;\n  }\n\n  formatDate(id, key, fmt=\"%d/%m/%Y\"){\n    let item = (_.isNumber(id)) ? this.findById(id) : id;\n    let df   = item.get(`${key}Df`);\n    // console.log(\"DateFormmater\", df)\n    if(df){\n      return df.formatDate(fmt);\n    }\n\n    return \"\";\n  }\n\n  getDateKeys(item){\n    let dateRegExp   = new RegExp(/^\\s*(\\d{4})-(\\d{2})-(\\d{2})+!?(\\s(\\d{2}):(\\d{2})|\\s(\\d{2}):(\\d{2}):(\\d+))?$/);\n    let dateKeys = [];\n    _.forIn(item, (v, k)=>{\n      if(_.isString(v)){\n        let date_match = v.match(dateRegExp);\n        if(!_.isNull(date_match)){\n          dateKeys.push(k);\n        }\n      }\n    });\n\n    return dateKeys;\n  }\n\n  each(){\n    let args = Array.prototype.slice.call(arguments);\n    let func    = args[0];\n    let context = args[1];\n    if(!_.isFunction(func)){\n      throw new Error(\"Must be a function\");\n    }\n\n    if(_.isNull(this.data)){\n      throw new Error(\"Please add data to iterating\");\n    }\n\n    if(context){\n      this.data.forEach(func.bind(context));\n    } else {\n      this.data.forEach(func);\n    }\n  }\n\n  fetch(progress, clear=false){\n    if(clear){\n      this.clearAll();\n    }\n\n    this.setUrl();\n\n    return this.ajaxPromises.fetch(progress).then(function(data){\n      this.add(data);\n      return data;\n    }.bind(this)).catch((err)=>{\n      throw new Error(err);\n    });\n  }\n\n  findById(id){\n    return this.data.find((d)=>  d.get(\"id\") === id );\n  }\n\n  findByIndex(i){\n    return this.data.get(i);\n  }\n\n  getAll(){\n    return this.data;\n  }\n\n  getKeys(hard=false){\n    if(!this.keys || hard){\n      let item  = this.data.first();\n      let k     = item.keySeq();\n      this.keys = k.toJS();\n    }\n\n    return this.keys;\n  }\n\n  init(fet){\n    if(fet){\n      this.fetch();\n    }\n  }\n\n  manageDates(items){\n    let date_keys = this.getDateKeys(_.first(items));\n    if(_.isEmpty(date_keys)){\n      return items;\n    }\n\n    return _.map(items, (item)=>{\n      return this.addDates(item, date_keys);\n    });\n\n  }\n\n  remove(id){\n    let del = this.findById(id);\n\n    if(del){\n      let i     = this.data.indexOf(del);\n      this.data = this.data.delete(i);\n      return del;\n\n    }\n    this.warn(\"Can't find item\");\n    return null;\n  }\n\n  resetHard(i){\n    this.resetTo(i);\n    this.history = this.history.splice(0, i);\n  }\n\n  resetTo(i){\n    this.data = this.history[i];\n  }\n\n  search(val, keys){\n    if(this.dataCheck(val)){\n      let regex = new RegExp(val, \"i\");\n      return this.data.filter((d)=>{\n        if(keys.length > 1){\n\n          let values = d.filter((v, k)=>{\n            return _.contains(keys, k);\n          });\n          let all = values.valueSeq().toJS().join(\" \");\n\n          return (all.search(regex) > -1);\n\n        } else {\n          let key = keys[0];\n          if(d.has(key)){\n            let value = d.get(key);\n            return (String(value).search(regex) > -1);\n          } else {\n            return false;\n          }\n        }\n\n        return true;\n      });\n    }\n\n\n    return this.data;\n  }\n\n  sort(key, asc=true){\n    // this.addToHistory();\n    return this.data.sort((a, b)=>{\n      let itemA = (asc) ? a.get(key) : b.get(key);\n      let itemB = (asc) ? b.get(key) : a.get(key);\n      if(_.isString(itemA) && _.isString(itemB)){\n        itemA = itemA.toLowerCase();\n        itemB = itemB.toLowerCase();\n      }\n      return this.sortAlgorithm(itemA, itemB);\n    });\n  }\n\n  sortAlgorithm(itemA, itemB){\n    if(itemA < itemB) {\n      return -1;\n    }\n\n    if (itemA > itemB){\n      return 1;\n    }\n\n    return 0;\n  }\n\n  setUrl(){\n    let uri = (_.isFunction(this.url)) ? this.url() : this.url;\n    this.ajaxPromises.addUrl(uri);\n  }\n\n  sync(id){\n    let send = this.findById(id);\n    this.setUrl();\n\n    return this.ajaxPromises.update(send.toJS(), id).catch((err)=>{\n      throw new Error(err);\n    });\n  }\n\n\n  update(id, updates, sync=false){\n    if(this.dataCheck(updates)){\n      this.addToHistory();\n      this.data = this.data.map((d)=>{\n        // console.log(d)\n        if(String(d.get(\"id\")) === String(id)){\n          return this.updateItem(d, updates);\n        }\n\n        return d;\n      }.bind(this));\n\n      if(sync){\n        this.sync(id);\n      }\n    }\n\n    return null;\n  }\n\n  updateItem(item, data){\n    _.forIn(data, (v, k)=> item = item.set(k, v));\n    return item;\n  }\n\n  updateAll(updates){\n    if(this.dataCheck(updates)){\n      this.addToHistory();\n\n      this.data = this.data.map((d)=>{\n        return this.updateItem(d, updates);\n      }.bind(this));\n    }\n    return null;\n  }\n\n  warn(warning){\n    if(console.warn){\n      console.warn(warning);\n    }\n  }\n}\n\nmodule.exports = DataManager;\n"]}