{"version":3,"sources":["../src/dataMultiload.js"],"names":[],"mappings":"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","file":"dataMultiload.js","sourcesContent":["\n\nconst DataManager  = require('../lib/dataManager');\nconst _            = require('lodash');\nconst Immutable    = require('immutable');\nconst AjaxPromises = require(\"ajax-es6-module\");\n\nclass DataMultiLoad extends DataManager {\n\n  checkMulti(data){\n    return ((!_.isArray(data)) && _.isNumber(data.page) && _.isBoolean(data.ended));\n  }\n\n  checkLast(data){\n    return data(\"ended\");\n  }\n\n  createAjax(){\n    this.ajaxList = this.ajaxList || [];\n    let ajax = new AjaxPromises();\n    this.ajaxList.push(ajax)\n    return ajax;\n  }\n\n  createProgress(func, ...args){\n    let argsApply = args;\n    let progFn    = func;\n    return function(){\n      let newArgs = Array.prototype.slice.call(arguments);\n      progFn.apply(this, argsApply.concat(newArgs));\n    }\n  }\n\n\n  dataAdd(data){\n    this.dataList = this.dataList || [];\n    if(this.checkMulti(data)){\n      let d = this.setData(data);\n      this.add(d(\"data\"));\n      this.dataList.push(d);\n      return d;\n    } else {\n      this.add(data);\n      return data;\n    }\n  }\n\n  fetch(progress, ...args){\n    this.manageUrl.apply(this, args);\n\n    if(_.isString(this.url)){\n      return this.fetcher(progress, (data)=>{\n        return this.dataAdd(data);\n      }, this.ajaxPromises);\n    }\n\n\n    // return this.fetchMulti(progress);\n\n  }\n\n  fetcher(progFn, thenFn, ...args){\n    let ajaxProm = _.find(args, (arg)=>_.isFunction(arg) || _.isObject(arg) );\n    let limit    = _.find(args, (arg)=>_.isNumber(arg));\n\n    let ajax = (ajaxProm) ? ajaxProm : this.createAjax();\n    let url  = (_.isFunction(this.url)) ? this.url(limit) : this.url;\n    ajax.setUrl(url);\n\n    return ajax.fetch(progFn).then(thenFn).catch((err)=>{\n      throw new Error(err);\n    });\n  }\n\n  fetchFirst(progress){\n    return this.fetcher(progress, (data)=>{\n      let d = this.dataAdd(data);\n      if(!d(\"last\")){\n        return this.fetchMulti(progress, d(\"amount\"));\n      }\n\n      return d(\"data\");\n    });\n  }\n\n  fetchMulti(progress){\n    this.promiseList = [];\n    let i = 0;\n\n    do{\n      let n = i;\n      i++;\n      let promise = this.fetcher(\n        this.createProgress(progress, this.url(false), n),\n        (data)=>{\n          let d =  this.dataAdd(data);\n          if(d(\"last\")){\n            return {data:d(\"data\"), last:d('last')}\n          }\n\n          return d(\"data\")\n        }\n      );\n\n      this.promiseList.push(promise);\n    } while(this.url(false));\n\n    return Promise.all(this.promiseList);\n  }\n\n   getUrl(url, identifier=\"\", limit=1){\n    if(identifier === \"\"){\n      return url;\n    }\n\n    const baseId  = identifier;\n    const baseUrl =  url;\n    var count     = 0;\n    var limit     = limit;\n    return function(...args){\n      let l    = _.find(args, (arg)=>_.isNumber(arg));\n      let inc  = _.find(args, (arg)=>_.isBoolean(arg));\n\n      let increment = (_.isBoolean(inc)) ? inc : true;\n      limit = (l) ? l : limit;\n\n      if(count === limit) {\n        return false;\n      }\n\n      let path = baseUrl.replace(baseId, count);\n\n      if(increment) {\n        count++;\n      }\n\n      return path;\n    }\n\n\n\n  }\n\n  setData(d){\n    var data = d;\n\n    return function(attr){\n      return data[attr];\n    }\n  }\n\n  manageUrl(url, id, limit){\n    if(_.isEmpty(url) && _.isUndefined(this.url)){\n      throw new Error(\"not a valid url\")\n    }\n\n    this.url = this.getUrl(url, id, limit);\n    if(_.isString(this.url)){\n      this.ajaxPromises.addUrl(this.url);\n    }\n  }\n\n}\n\nmodule.exports = DataMultiLoad;"]}